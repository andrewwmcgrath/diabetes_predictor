import pandas as pd
import numpy as np
import warnings
from sklearn.impute import SimpleImputer
import os
import re

warnings.filterwarnings("ignore")
directory = os.getcwd()
input_file_path = os.path.join(directory, 'balanced_data.csv') 
output_file_path = os.path.join(directory, 'cleaned.csv')

df = pd.read_csv(input_file_path)
print(f"Data loaded successfully with shape: {df.shape}")

df['will_develop_diabetes'] = df['will_develop_diabetes'].map({'yes': 1, 'no': 0})

diabetics = df['will_develop_diabetes']
when_diabetics = df['when_develops_diabetes']
mean1 = diabetics.mean()
mean2 = when_diabetics.mean()
print(f'Checking means: mean_develops_diabetes = {mean1} = 0.5? mean_develops_diabetes = {mean2} > 0.5?')

infer_diabetes = [
    'eid_Unnamed: 0_level_1',
    '2443-1.0_Diabetes diagnosed by doctor', '2443-2.0_Diabetes diagnosed by doctor', '2443-3.0_Diabetes diagnosed by doctor',
    '2976-0.0_Age diabetes diagnosed',
    '4041-0.0_Gestational diabetes only',
    '5890-0.0_Which eye(s) affected by diabetes-related eye disease',
    '5901-0.0_Age when diabetes-related eye disease diagnosed',
    '6153-0.0_Medication for cholesterol, blood pressure, diabetes, or take exogenous hormones', '6153-0.1_Medication for cholesterol, blood pressure, diabetes, or take exogenous hormones', '6153-0.2_Medication for cholesterol, blood pressure, diabetes, or take exogenous hormones', '6153-0.3_Medication for cholesterol, blood pressure, diabetes, or take exogenous hormones',
    '6177-0.0_Medication for cholesterol, blood pressure or diabetes', '6177-0.1_Medication for cholesterol, blood pressure or diabetes', '6177-0.2_Medication for cholesterol, blood pressure or diabetes', 
    '10844-0.0_Gestational diabetes only (pilot)',
    '20013-0.0_Method of recording time when non-cancer illness first diagnosed', '20013-0.1_Method of recording time when non-cancer illness first diagnosed', '20013-0.2_Method of recording time when non-cancer illness first diagnosed', '20013-0.3_Method of recording time when non-cancer illness first diagnosed', '20013-0.4_Method of recording time when non-cancer illness first diagnosed', '20013-0.5_Method of recording time when non-cancer illness first diagnosed', '20013-0.6_Method of recording time when non-cancer illness first diagnosed', '20013-0.7_Method of recording time when non-cancer illness first diagnosed', '20013-0.8_Method of recording time when non-cancer illness first diagnosed', '20013-0.9_Method of recording time when non-cancer illness first diagnosed', '20013-0.10_Method of recording time when non-cancer illness first diagnosed', '20013-0.11_Method of recording time when non-cancer illness first diagnosed', '20013-0.12_Method of recording time when non-cancer illness first diagnosed', '20013-0.13_Method of recording time when non-cancer illness first diagnosed', '20013-0.14_Method of recording time when non-cancer illness first diagnosed', '20013-0.15_Method of recording time when non-cancer illness first diagnosed', '20013-0.16_Method of recording time when non-cancer illness first diagnosed', '20013-0.17_Method of recording time when non-cancer illness first diagnosed', '20013-0.18_Description not found', '20013-0.19_Description not found', '20013-0.20_Method of recording time when non-cancer illness first diagnosed', '20013-0.21_Method of recording time when non-cancer illness first diagnosed', '20013-0.22_Method of recording time when non-cancer illness first diagnosed', '20013-0.23_Method of recording time when non-cancer illness first diagnosed', '20013-0.24_Method of recording time when non-cancer illness first diagnosed', '20013-0.25_Method of recording time when non-cancer illness first diagnosed', '20013-0.26_Method of recording time when non-cancer illness first diagnosed', '20013-0.27_Method of recording time when non-cancer illness first diagnosed', '20013-0.28_Method of recording time when non-cancer illness first diagnosed', '20013-0.29_Method of recording time when non-cancer illness first diagnosed', '20013-0.30_Method of recording time when non-cancer illness first diagnosed', '20013-0.31_Method of recording time when non-cancer illness first diagnosed', '20013-0.32_Method of recording time when non-cancer illness first diagnosed', '20013-0.33_Method of recording time when non-cancer illness first diagnosed',
    '20002-0.0_Non-cancer illness code, self-reported', '20002-0.1_Non-cancer illness code, self-reported', '20002-0.2_Non-cancer illness code, self-reported', '20002-0.3_Non-cancer illness code, self-reported', '20002-0.4_Non-cancer illness code, self-reported', '20002-0.5_Non-cancer illness code, self-reported', '20002-0.6_Non-cancer illness code, self-reported', '20002-0.7_Non-cancer illness code, self-reported', '20002-0.8_Non-cancer illness code, self-reported', '20002-0.9_Non-cancer illness code, self-reported', '20002-0.10_Non-cancer illness code, self-reported', '20002-0.11_Non-cancer illness code, self-reported', '20002-0.12_Non-cancer illness code, self-reported', '20002-0.13_Non-cancer illness code, self-reported', '20002-0.14_Non-cancer illness code, self-reported', '20002-0.15_Non-cancer illness code, self-reported', '20002-0.16_Non-cancer illness code, self-reported', '20002-0.17_Non-cancer illness code, self-reported', '20002-0.18_Non-cancer illness code, self-reported', '20002-0.19_Non-cancer illness code, self-reported', '20002-0.20_Non-cancer illness code, self-reported', '20002-0.21_Non-cancer illness code, self-reported', '20002-0.22_Non-cancer illness code, self-reported', '20002-0.23_Non-cancer illness code, self-reported', '20002-0.24_Non-cancer illness code, self-reported', '20002-0.25_Non-cancer illness code, self-reported', '20002-0.26_Non-cancer illness code, self-reported', '20002-0.27_Non-cancer illness code, self-reported', '20002-0.28_Non-cancer illness code, self-reported', '20002-0.29_Non-cancer illness code, self-reported', '20002-0.30_Non-cancer illness code, self-reported', '20002-0.31_Non-cancer illness code, self-reported', '20002-0.32_Non-cancer illness code, self-reported', '20002-0.33_Non-cancer illness code, self-reported',
    '20003-0.0_Treatment/medication code', '20003-0.1_Treatment/medication code', '20003-0.2_Treatment/medication code', '20003-0.3_Treatment/medication code', '20003-0.4_Treatment/medication code', '20003-0.5_Treatment/medication code', '20003-0.6_Treatment/medication code', '20003-0.7_Treatment/medication code', '20003-0.8_Treatment/medication code', '20003-0.9_Treatment/medication code', '20003-0.10_Treatment/medication code', '20003-0.11_Treatment/medication code', '20003-0.12_Treatment/medication code', '20003-0.13_Treatment/medication code', '20003-0.14_Treatment/medication code', '20003-0.15_Treatment/medication code', '20003-0.16_Treatment/medication code', '20003-0.17_Treatment/medication code', '20003-0.18_Treatment/medication code', '20003-0.19_Treatment/medication code', '20003-0.20_Treatment/medication code', '20003-0.21_Treatment/medication code', '20003-0.22_Treatment/medication code', '20003-0.23_Treatment/medication code', '20003-0.24_Treatment/medication code', '20003-0.25_Treatment/medication code', '20003-0.26_Treatment/medication code', '20003-0.27_Treatment/medication code', '20003-0.28_Treatment/medication code', '20003-0.29_Treatment/medication code', '20003-0.30_Treatment/medication code', '20003-0.31_Treatment/medication code', '20003-0.32_Treatment/medication code', '20003-0.33_Treatment/medication code', '20003-0.34_Treatment/medication code', '20003-0.35_Treatment/medication code', '20003-0.36_Treatment/medication code', '20003-0.37_Treatment/medication code', '20003-0.38_Treatment/medication code', '20003-0.39_Treatment/medication code', '20003-0.40_Treatment/medication code', '20003-0.41_Treatment/medication code', '20003-0.42_Treatment/medication code', '20003-0.43_Treatment/medication code', '20003-0.44_Treatment/medication code', '20003-0.45_Treatment/medication code', '20003-0.46_Treatment/medication code', '20003-0.47_Treatment/medication code',
    '135-0.0_Number of self-reported non-cancer illnesses',
    '137-0.0_Number of treatments/medications taken',
    '87-0.0_Non-cancer illness year/age first occurred', '87-0.1_Non-cancer illness year/age first occurred', '87-0.2_Non-cancer illness year/age first occurred', '87-0.3_Non-cancer illness year/age first occurred', '87-0.4_Non-cancer illness year/age first occurred', '87-0.5_Non-cancer illness year/age first occurred', '87-0.6_Non-cancer illness year/age first occurred', '87-0.7_Non-cancer illness year/age first occurred', '87-0.8_Non-cancer illness year/age first occurred', '87-0.9_Non-cancer illness year/age first occurred', '87-0.10_Non-cancer illness year/age first occurred', '87-0.11_Non-cancer illness year/age first occurred', '87-0.12_Non-cancer illness year/age first occurred', '87-0.13_Non-cancer illness year/age first occurred', '87-0.14_Non-cancer illness year/age first occurred', '87-0.15_Non-cancer illness year/age first occurred', '87-0.16_Non-cancer illness year/age first occurred', '87-0.17_Non-cancer illness year/age first occurred', '87-0.18_Non-cancer illness year/age first occurred', '87-0.19_Non-cancer illness year/age first occurred', '87-0.20_Non-cancer illness year/age first occurred', '87-0.21_Non-cancer illness year/age first occurred', '87-0.22_Non-cancer illness year/age first occurred', '87-0.23_Non-cancer illness year/age first occurred', '87-0.24_Non-cancer illness year/age first occurred', '87-0.25_Non-cancer illness year/age first occurred', '87-0.26_Non-cancer illness year/age first occurred', '87-0.27_Non-cancer illness year/age first occurred', '87-0.28_Non-cancer illness year/age first occurred', '87-0.29_Non-cancer illness year/age first occurred', '87-0.30_Non-cancer illness year/age first occurred', '87-0.31_Non-cancer illness year/age first occurred', '87-0.32_Non-cancer illness year/age first occurred', '87-0.33_Non-cancer illness year/age first occurred',
    '20008-0.0_Interpolated Year when non-cancer illness first diagnosed', '20008-0.1_Interpolated Year when non-cancer illness first diagnosed', '20008-0.2_Interpolated Year when non-cancer illness first diagnosed', '20008-0.3_Interpolated Year when non-cancer illness first diagnosed', '20008-0.4_Interpolated Year when non-cancer illness first diagnosed', '20008-0.5_Interpolated Year when non-cancer illness first diagnosed', '20008-0.6_Interpolated Year when non-cancer illness first diagnosed', '20008-0.7_Interpolated Year when non-cancer illness first diagnosed', '20008-0.8_Interpolated Year when non-cancer illness first diagnosed', '20008-0.9_Interpolated Year when non-cancer illness first diagnosed', '20008-0.10_Interpolated Year when non-cancer illness first diagnosed', '20008-0.11_Interpolated Year when non-cancer illness first diagnosed', '20008-0.12_Interpolated Year when non-cancer illness first diagnosed', '20008-0.13_Interpolated Year when non-cancer illness first diagnosed', '20008-0.14_Interpolated Year when non-cancer illness first diagnosed', '20008-0.15_Interpolated Year when non-cancer illness first diagnosed', '20008-0.16_Interpolated Year when non-cancer illness first diagnosed', '20008-0.17_Interpolated Year when non-cancer illness first diagnosed', '20008-0.18_Interpolated Year when non-cancer illness first diagnosed', '20008-0.19_Interpolated Year when non-cancer illness first diagnosed', '20008-0.20_Interpolated Year when non-cancer illness first diagnosed', '20008-0.21_Interpolated Year when non-cancer illness first diagnosed', '20008-0.22_Interpolated Year when non-cancer illness first diagnosed', '20008-0.23_Interpolated Year when non-cancer illness first diagnosed', '20008-0.24_Interpolated Year when non-cancer illness first diagnosed', '20008-0.25_Interpolated Year when non-cancer illness first diagnosed', '20008-0.26_Interpolated Year when non-cancer illness first diagnosed', '20008-0.27_Interpolated Year when non-cancer illness first diagnosed', '20008-0.28_Interpolated Year when non-cancer illness first diagnosed', '20008-0.29_Interpolated Year when non-cancer illness first diagnosed', '20008-0.30_Interpolated Year when non-cancer illness first diagnosed', '20008-0.31_Interpolated Year when non-cancer illness first diagnosed', '20008-0.32_Interpolated Year when non-cancer illness first diagnosed', '20008-0.33_Interpolated Year when non-cancer illness first diagnosed',
    '20009-0.0_Interpolated Age of participant when non-cancer illness first diagnosed', '20009-0.1_Interpolated Age of participant when non-cancer illness first diagnosed', '20009-0.2_Interpolated Age of participant when non-cancer illness first diagnosed', '20009-0.3_Interpolated Age of participant when non-cancer illness first diagnosed', '20009-0.4_Interpolated Age of participant when non-cancer illness first diagnosed', '20009-0.5_Interpolated Age of participant when non-cancer illness first diagnosed', '20009-0.6_Interpolated Age of participant when non-cancer illness first diagnosed', '20009-0.7_Interpolated Age of participant when non-cancer illness first diagnosed', '20009-0.8_Interpolated Age of participant when non-cancer illness first diagnosed', '20009-0.9_Interpolated Age of participant when non-cancer illness first diagnosed', '20009-0.10_Interpolated Age of participant when non-cancer illness first diagnosed', '20009-0.11_Interpolated Age of participant when non-cancer illness first diagnosed', '20009-0.12_Interpolated Age of participant when non-cancer illness first diagnosed', '20009-0.13_Interpolated Age of participant when non-cancer illness first diagnosed', '20009-0.14_Interpolated Age of participant when non-cancer illness first diagnosed', '20009-0.15_Interpolated Age of participant when non-cancer illness first diagnosed', '20009-0.16_Interpolated Age of participant when non-cancer illness first diagnosed', '20009-0.17_Interpolated Age of participant when non-cancer illness first diagnosed', '20009-0.18_Interpolated Age of participant when non-cancer illness first diagnosed', '20009-0.19_Interpolated Age of participant when non-cancer illness first diagnosed', '20009-0.20_Interpolated Age of participant when non-cancer illness first diagnosed', '20009-0.21_Interpolated Age of participant when non-cancer illness first diagnosed', '20009-0.22_Interpolated Age of participant when non-cancer illness first diagnosed', '20009-0.23_Interpolated Age of participant when non-cancer illness first diagnosed', '20009-0.24_Interpolated Age of participant when non-cancer illness first diagnosed', '20009-0.25_Interpolated Age of participant when non-cancer illness first diagnosed', '20009-0.26_Interpolated Age of participant when non-cancer illness first diagnosed', '20009-0.27_Interpolated Age of participant when non-cancer illness first diagnosed', '20009-0.28_Interpolated Age of participant when non-cancer illness first diagnosed', '20009-0.29_Interpolated Age of participant when non-cancer illness first diagnosed', '20009-0.30_Interpolated Age of participant when non-cancer illness first diagnosed', '20009-0.31_Interpolated Age of participant when non-cancer illness first diagnosed', '20009-0.32_Interpolated Age of participant when non-cancer illness first diagnosed', '20009-0.33_Interpolated Age of participant when non-cancer illness first diagnosed',
    '2188-0.0_Long-standing illness, disability or infirmity',
    '2492-0.0_Taking other prescription medications',
    '41260-0.0_Date of first operative procedure - main OPCS4', '41260-0.1_Date of first operative procedure - main OPCS4', '41260-0.2_Date of first operative procedure - main OPCS4', '41260-0.3_Date of first operative procedure - main OPCS4', '41260-0.4_Date of first operative procedure - main OPCS4', '41260-0.5_Date of first operative procedure - main OPCS4', '41260-0.6_Date of first operative procedure - main OPCS4', '41260-0.7_Date of first operative procedure - main OPCS4', '41260-0.8_Date of first operative procedure - main OPCS4', '41260-0.9_Date of first operative procedure - main OPCS4', '41260-0.10_Date of first operative procedure - main OPCS4', '41260-0.11_Date of first operative procedure - main OPCS4', '41260-0.12_Date of first operative procedure - main OPCS4', '41260-0.13_Date of first operative procedure - main OPCS4', '41260-0.14_Date of first operative procedure - main OPCS4', '41260-0.15_Date of first operative procedure - main OPCS4', '41260-0.16_Date of first operative procedure - main OPCS4', '41260-0.17_Date of first operative procedure - main OPCS4', '41260-0.18_Date of first operative procedure - main OPCS4', '41260-0.19_Date of first operative procedure - main OPCS4', '41260-0.20_Date of first operative procedure - main OPCS4', '41260-0.21_Date of first operative procedure - main OPCS4', '41260-0.22_Date of first operative procedure - main OPCS4', '41260-0.23_Date of first operative procedure - main OPCS4', '41260-0.24_Date of first operative procedure - main OPCS4', '41260-0.25_Date of first operative procedure - main OPCS4', '41260-0.26_Date of first operative procedure - main OPCS4', '41260-0.27_Date of first operative procedure - main OPCS4', '41260-0.28_Date of first operative procedure - main OPCS4', '41260-0.29_Date of first operative procedure - main OPCS4', '41260-0.30_Date of first operative procedure - main OPCS4', '41260-0.31_Date of first operative procedure - main OPCS4', '41260-0.32_Date of first operative procedure - main OPCS4', '41260-0.33_Date of first operative procedure - main OPCS4','41260-0.34_Date of first operative procedure - main OPCS4', '41260-0.35_Date of first operative procedure - main OPCS4', '41260-0.36_Date of first operative procedure - main OPCS4', '41260-0.37_Date of first operative procedure - main OPCS4', '41260-0.38_Date of first operative procedure - main OPCS4', '41260-0.39_Date of first operative procedure - main OPCS4', '41260-0.40_Date of first operative procedure - main OPCS4', '41260-0.41_Date of first operative procedure - main OPCS4', '41260-0.42_Date of first operative procedure - main OPCS4', '41260-0.43_Date of first operative procedure - main OPCS4', '41260-0.44_Date of first operative procedure - main OPCS4', '41260-0.45_Date of first operative procedure - main OPCS4', '41260-0.46_Date of first operative procedure - main OPCS4', '41260-0.47_Date of first operative procedure - main OPCS4',
    '41262-0.0_Date of first in-patient diagnosis - main ICD10', '41262-0.1_Date of first in-patient diagnosis - main ICD10', '41262-0.2_Date of first in-patient diagnosis - main ICD10', '41262-0.3_Date of first in-patient diagnosis - main ICD10', '41262-0.4_Date of first in-patient diagnosis - main ICD10', '41262-0.5_Date of first in-patient diagnosis - main ICD10', '41262-0.6_Date of first in-patient diagnosis - main ICD10', '41262-0.7_Date of first in-patient diagnosis - main ICD10','41262-0.8_Date of first in-patient diagnosis - main ICD10', '41262-0.9_Date of first in-patient diagnosis - main ICD10', '41262-0.10_Date of first in-patient diagnosis - main ICD10', '41262-0.11_Date of first in-patient diagnosis - main ICD10', '41262-0.12_Date of first in-patient diagnosis - main ICD10', '41262-0.13_Date of first in-patient diagnosis - main ICD10', '41262-0.14_Date of first in-patient diagnosis - main ICD10', '41262-0.15_Date of first in-patient diagnosis - main ICD10', '41262-0.16_Date of first in-patient diagnosis - main ICD10', '41262-0.17_Date of first in-patient diagnosis - main ICD10', '41262-0.18_Date of first in-patient diagnosis - main ICD10', '41262-0.19_Date of first in-patient diagnosis - main ICD10', '41262-0.20_Date of first in-patient diagnosis - main ICD10', '41262-0.21_Date of first in-patient diagnosis - main ICD10', '41262-0.22_Date of first in-patient diagnosis - main ICD10', '41262-0.23_Date of first in-patient diagnosis - main ICD10', '41262-0.24_Date of first in-patient diagnosis - main ICD10', '41262-0.25_Date of first in-patient diagnosis - main ICD10', '41262-0.26_Date of first in-patient diagnosis - main ICD10', '41262-0.27_Date of first in-patient diagnosis - main ICD10', '41262-0.28_Date of first in-patient diagnosis - main ICD10', '41262-0.29_Date of first in-patient diagnosis - main ICD10', '41262-0.30_Date of first in-patient diagnosis - main ICD10', '41262-0.31_Date of first in-patient diagnosis - main ICD10', '41262-0.32_Date of first in-patient diagnosis - main ICD10', '41262-0.33_Date of first in-patient diagnosis - main ICD10', '41262-0.34_Date of first in-patient diagnosis - main ICD10', '41262-0.35_Date of first in-patient diagnosis - main ICD10', '41262-0.36_Date of first in-patient diagnosis - main ICD10', '41262-0.37_Date of first in-patient diagnosis - main ICD10', '41262-0.38_Date of first in-patient diagnosis - main ICD10', '41262-0.39_Date of first in-patient diagnosis - main ICD10','41262-0.40_Date of first in-patient diagnosis - main ICD10', '41262-0.41_Date of first in-patient diagnosis - main ICD10', '41262-0.42_Date of first in-patient diagnosis - main ICD10', '41262-0.43_Date of first in-patient diagnosis - main ICD10', '41262-0.44_Date of first in-patient diagnosis - main ICD10', '41262-0.45_Date of first in-patient diagnosis - main ICD10', '41262-0.46_Date of first in-patient diagnosis - main ICD10', '41262-0.47_Date of first in-patient diagnosis - main ICD10', '41262-0.48_Date of first in-patient diagnosis - main ICD10', '41262-0.49_Date of first in-patient diagnosis - main ICD10', '41262-0.50_Date of first in-patient diagnosis - main ICD10', '41262-0.51_Date of first in-patient diagnosis - main ICD10', '41262-0.52_Date of first in-patient diagnosis - main ICD10', '41262-0.53_Date of first in-patient diagnosis - main ICD10', '41262-0.54_Date of first in-patient diagnosis - main ICD10', '41262-0.55_Date of first in-patient diagnosis - main ICD10', '41262-0.56_Date of first in-patient diagnosis - main ICD10', '41262-0.57_Date of first in-patient diagnosis - main ICD10', '41262-0.58_Date of first in-patient diagnosis - main ICD10', '41262-0.59_Date of first in-patient diagnosis - main ICD10', '41262-0.60_Date of first in-patient diagnosis - main ICD10', '41262-0.61_Date of first in-patient diagnosis - main ICD10', '41262-0.62_Date of first in-patient diagnosis - main ICD10', '41262-0.63_Date of first in-patient diagnosis - main ICD10', '41262-0.64_Date of first in-patient diagnosis - main ICD10', '41262-0.65_Date of first in-patient diagnosis - main ICD10', '41262-0.66_Date of first in-patient diagnosis - main ICD10', '41262-0.67_Date of first in-patient diagnosis - main ICD10',  '41262-0.68_Date of first in-patient diagnosis - main ICD10', '41262-0.69_Date of first in-patient diagnosis - main ICD10', '41262-0.70_Date of first in-patient diagnosis - main ICD10', '41262-0.71_Date of first in-patient diagnosis - main ICD10', '41262-0.72_Date of first in-patient diagnosis - main ICD10', '41262-0.73_Date of first in-patient diagnosis - main ICD10', '41262-0.74_Date of first in-patient diagnosis - main ICD10', '41262-0.75_Date of first in-patient diagnosis - main ICD10', '41262-0.76_Date of first in-patient diagnosis - main ICD10', '41262-0.77_Date of first in-patient diagnosis - main ICD10', '41262-0.78_Date of first in-patient diagnosis - main ICD10',
    '41263-0.0_Date of first in-patient diagnosis - main ICD9', '41263-0.1_Date of first in-patient diagnosis - main ICD9', '41263-0.2_Date of first in-patient diagnosis - main ICD9', '41263-0.3_Date of first in-patient diagnosis - main ICD9', '41263-0.4_Date of first in-patient diagnosis - main ICD9', '41263-0.5_Date of first in-patient diagnosis - main ICD9', '41263-0.6_Date of first in-patient diagnosis - main ICD9', '41263-0.7_Date of first in-patient diagnosis - main ICD9', '41263-0.8_Date of first in-patient diagnosis - main ICD9', '41263-0.9_Date of first in-patient diagnosis - main ICD9', '41263-0.10_Date of first in-patient diagnosis - main ICD9', '41263-0.11_Date of first in-patient diagnosis - main ICD9', '41263-0.12_Date of first in-patient diagnosis - main ICD9', '41263-0.13_Date of first in-patient diagnosis - main ICD9', '41263-0.14_Date of first in-patient diagnosis - main ICD9', '41263-0.15_Date of first in-patient diagnosis - main ICD9', '41263-0.16_Date of first in-patient diagnosis - main ICD9', '41263-0.17_Date of first in-patient diagnosis - main ICD9', '41263-0.18_Date of first in-patient diagnosis - main ICD9', '41263-0.19_Date of first in-patient diagnosis - main ICD9', '41263-0.20_Date of first in-patient diagnosis - main ICD9', '41263-0.21_Date of first in-patient diagnosis - main ICD9', '41263-0.22_Date of first in-patient diagnosis - main ICD9', '41263-0.23_Date of first in-patient diagnosis - main ICD9', '41263-0.24_Date of first in-patient diagnosis - main ICD9', '41263-0.25_Date of first in-patient diagnosis - main ICD9', '41263-0.26_Date of first in-patient diagnosis - main ICD9', '41263-0.27_Date of first in-patient diagnosis - main ICD9',
    '41280-0.0_Date of first in-patient diagnosis - ICD10', '41280-0.1_Date of first in-patient diagnosis - ICD10', '41280-0.2_Date of first in-patient diagnosis - ICD10', '41280-0.3_Date of first in-patient diagnosis - ICD10', '41280-0.4_Date of first in-patient diagnosis - ICD10', '41280-0.5_Date of first in-patient diagnosis - ICD10', '41280-0.6_Date of first in-patient diagnosis - ICD10', '41280-0.7_Date of first in-patient diagnosis - ICD10', '41280-0.8_Date of first in-patient diagnosis - ICD10', '41280-0.9_Date of first in-patient diagnosis - ICD10', '41280-0.10_Date of first in-patient diagnosis - ICD10', '41280-0.11_Date of first in-patient diagnosis - ICD10', '41280-0.12_Date of first in-patient diagnosis - ICD10', '41280-0.13_Date of first in-patient diagnosis - ICD10', '41280-0.14_Date of first in-patient diagnosis - ICD10', '41280-0.15_Date of first in-patient diagnosis - ICD10','41280-0.16_Date of first in-patient diagnosis - ICD10', '41280-0.17_Date of first in-patient diagnosis - ICD10', '41280-0.18_Date of first in-patient diagnosis - ICD10', '41280-0.19_Date of first in-patient diagnosis - ICD10', '41280-0.20_Date of first in-patient diagnosis - ICD10', '41280-0.21_Date of first in-patient diagnosis - ICD10', '41280-0.22_Date of first in-patient diagnosis - ICD10', '41280-0.23_Date of first in-patient diagnosis - ICD10', '41280-0.24_Date of first in-patient diagnosis - ICD10', '41280-0.25_Date of first in-patient diagnosis - ICD10', '41280-0.26_Date of first in-patient diagnosis - ICD10', '41280-0.27_Date of first in-patient diagnosis - ICD10', '41280-0.28_Date of first in-patient diagnosis - ICD10', '41280-0.29_Date of first in-patient diagnosis - ICD10', '41280-0.30_Date of first in-patient diagnosis - ICD10', '41280-0.31_Date of first in-patient diagnosis - ICD10', '41280-0.32_Date of first in-patient diagnosis - ICD10', '41280-0.33_Date of first in-patient diagnosis - ICD10', '41280-0.34_Date of first in-patient diagnosis - ICD10', '41280-0.35_Date of first in-patient diagnosis - ICD10', '41280-0.36_Date of first in-patient diagnosis - ICD10', '41280-0.37_Date of first in-patient diagnosis - ICD10', '41280-0.38_Date of first in-patient diagnosis - ICD10', '41280-0.39_Date of first in-patient diagnosis - ICD10', '41280-0.40_Date of first in-patient diagnosis - ICD10', '41280-0.41_Date of first in-patient diagnosis - ICD10', '41280-0.42_Date of first in-patient diagnosis - ICD10', '41280-0.43_Date of first in-patient diagnosis - ICD10', '41280-0.44_Date of first in-patient diagnosis - ICD10', '41280-0.45_Date of first in-patient diagnosis - ICD10', '41280-0.46_Date of first in-patient diagnosis - ICD10', '41280-0.47_Date of first in-patient diagnosis - ICD10', '41280-0.48_Date of first in-patient diagnosis - ICD10', '41280-0.49_Date of first in-patient diagnosis - ICD10', '41280-0.50_Date of first in-patient diagnosis - ICD10', '41280-0.51_Date of first in-patient diagnosis - ICD10', '41280-0.52_Date of first in-patient diagnosis - ICD10', '41280-0.53_Date of first in-patient diagnosis - ICD10', '41280-0.54_Date of first in-patient diagnosis - ICD10', '41280-0.55_Date of first in-patient diagnosis - ICD10', '41280-0.56_Date of first in-patient diagnosis - ICD10', '41280-0.57_Date of first in-patient diagnosis - ICD10', '41280-0.58_Date of first in-patient diagnosis - ICD10', '41280-0.59_Date of first in-patient diagnosis - ICD10', '41280-0.60_Date of first in-patient diagnosis - ICD10', '41280-0.61_Date of first in-patient diagnosis - ICD10', '41280-0.62_Date of first in-patient diagnosis - ICD10', '41280-0.63_Date of first in-patient diagnosis - ICD10', '41280-0.64_Date of first in-patient diagnosis - ICD10', '41280-0.65_Date of first in-patient diagnosis - ICD10', '41280-0.66_Date of first in-patient diagnosis - ICD10', '41280-0.67_Date of first in-patient diagnosis - ICD10', '41280-0.68_Date of first in-patient diagnosis - ICD10', '41280-0.69_Date of first in-patient diagnosis - ICD10', '41280-0.70_Date of first in-patient diagnosis - ICD10', '41280-0.71_Date of first in-patient diagnosis - ICD10', '41280-0.72_Date of first in-patient diagnosis - ICD10', '41280-0.73_Date of first in-patient diagnosis - ICD10', '41280-0.74_Date of first in-patient diagnosis - ICD10', '41280-0.75_Date of first in-patient diagnosis - ICD10', '41280-0.76_Date of first in-patient diagnosis - ICD10', '41280-0.77_Date of first in-patient diagnosis - ICD10', '41280-0.78_Date of first in-patient diagnosis - ICD10', '41280-0.79_Date of first in-patient diagnosis - ICD10', '41280-0.80_Date of first in-patient diagnosis - ICD10', '41280-0.81_Date of first in-patient diagnosis - ICD10', '41280-0.82_Date of first in-patient diagnosis - ICD10', '41280-0.83_Date of first in-patient diagnosis - ICD10', '41280-0.84_Date of first in-patient diagnosis - ICD10', '41280-0.85_Date of first in-patient diagnosis - ICD10', '41280-0.86_Date of first in-patient diagnosis - ICD10', '41280-0.87_Date of first in-patient diagnosis - ICD10', '41280-0.88_Date of first in-patient diagnosis - ICD10', '41280-0.89_Date of first in-patient diagnosis - ICD10', '41280-0.90_Date of first in-patient diagnosis - ICD10', '41280-0.91_Date of first in-patient diagnosis - ICD10', '41280-0.92_Date of first in-patient diagnosis - ICD10', '41280-0.93_Date of first in-patient diagnosis - ICD10', '41280-0.94_Date of first in-patient diagnosis - ICD10', '41280-0.95_Date of first in-patient diagnosis - ICD10', '41280-0.96_Date of first in-patient diagnosis - ICD10', '41280-0.97_Date of first in-patient diagnosis - ICD10', '41280-0.98_Date of first in-patient diagnosis - ICD10', '41280-0.99_Date of first in-patient diagnosis - ICD10', '41280-0.100_Date of first in-patient diagnosis - ICD10', '41280-0.101_Date of first in-patient diagnosis - ICD10', '41280-0.102_Date of first in-patient diagnosis - ICD10', '41280-0.103_Date of first in-patient diagnosis - ICD10', '41280-0.104_Date of first in-patient diagnosis - ICD10', '41280-0.105_Date of first in-patient diagnosis - ICD10', '41280-0.106_Date of first in-patient diagnosis - ICD10', '41280-0.107_Date of first in-patient diagnosis - ICD10', '41280-0.108_Date of first in-patient diagnosis - ICD10', '41280-0.109_Date of first in-patient diagnosis - ICD10', '41280-0.110_Date of first in-patient diagnosis - ICD10', '41280-0.111_Date of first in-patient diagnosis - ICD10', '41280-0.112_Date of first in-patient diagnosis - ICD10', '41280-0.113_Date of first in-patient diagnosis - ICD10', '41280-0.114_Date of first in-patient diagnosis - ICD10', '41280-0.115_Date of first in-patient diagnosis - ICD10', '41280-0.116_Date of first in-patient diagnosis - ICD10', '41280-0.117_Date of first in-patient diagnosis - ICD10', '41280-0.118_Date of first in-patient diagnosis - ICD10', '41280-0.119_Date of first in-patient diagnosis - ICD10', '41280-0.120_Date of first in-patient diagnosis - ICD10', '41280-0.121_Date of first in-patient diagnosis - ICD10', '41280-0.122_Date of first in-patient diagnosis - ICD10', '41280-0.123_Date of first in-patient diagnosis - ICD10', '41280-0.124_Date of first in-patient diagnosis - ICD10', '41280-0.125_Date of first in-patient diagnosis - ICD10', '41280-0.126_Date of first in-patient diagnosis - ICD10', '41280-0.127_Date of first in-patient diagnosis - ICD10', '41280-0.128_Date of first in-patient diagnosis - ICD10', '41280-0.129_Date of first in-patient diagnosis - ICD10', '41280-0.130_Date of first in-patient diagnosis - ICD10', '41280-0.131_Date of first in-patient diagnosis - ICD10', '41280-0.132_Date of first in-patient diagnosis - ICD10', '41280-0.133_Date of first in-patient diagnosis - ICD10', '41280-0.134_Date of first in-patient diagnosis - ICD10', '41280-0.135_Date of first in-patient diagnosis - ICD10', '41280-0.136_Date of first in-patient diagnosis - ICD10', '41280-0.137_Date of first in-patient diagnosis - ICD10', '41280-0.138_Date of first in-patient diagnosis - ICD10', '41280-0.139_Date of first in-patient diagnosis - ICD10', '41280-0.140_Date of first in-patient diagnosis - ICD10', '41280-0.141_Date of first in-patient diagnosis - ICD10', '41280-0.142_Date of first in-patient diagnosis - ICD10', '41280-0.143_Date of first in-patient diagnosis - ICD10', '41280-0.144_Date of first in-patient diagnosis - ICD10', '41280-0.145_Date of first in-patient diagnosis - ICD10', '41280-0.146_Date of first in-patient diagnosis - ICD10', '41280-0.147_Date of first in-patient diagnosis - ICD10', '41280-0.148_Date of first in-patient diagnosis - ICD10', '41280-0.149_Date of first in-patient diagnosis - ICD10', '41280-0.150_Date of first in-patient diagnosis - ICD10', '41280-0.151_Date of first in-patient diagnosis - ICD10', '41280-0.152_Date of first in-patient diagnosis - ICD10', '41280-0.153_Date of first in-patient diagnosis - ICD10', '41280-0.154_Date of first in-patient diagnosis - ICD10', '41280-0.155_Date of first in-patient diagnosis - ICD10', '41280-0.156_Date of first in-patient diagnosis - ICD10', '41280-0.157_Date of first in-patient diagnosis - ICD10', '41280-0.158_Date of first in-patient diagnosis - ICD10', '41280-0.159_Date of first in-patient diagnosis - ICD10', '41280-0.160_Date of first in-patient diagnosis - ICD10', '41280-0.161_Date of first in-patient diagnosis - ICD10', '41280-0.162_Date of first in-patient diagnosis - ICD10', '41280-0.163_Date of first in-patient diagnosis - ICD10', '41280-0.164_Date of first in-patient diagnosis - ICD10', '41280-0.165_Date of first in-patient diagnosis - ICD10', '41280-0.166_Date of first in-patient diagnosis - ICD10', '41280-0.167_Date of first in-patient diagnosis - ICD10', '41280-0.168_Date of first in-patient diagnosis - ICD10', '41280-0.169_Date of first in-patient diagnosis - ICD10', '41280-0.170_Date of first in-patient diagnosis - ICD10', '41280-0.171_Date of first in-patient diagnosis - ICD10', '41280-0.172_Date of first in-patient diagnosis - ICD10', '41280-0.173_Date of first in-patient diagnosis - ICD10', '41280-0.174_Date of first in-patient diagnosis - ICD10', '41280-0.175_Date of first in-patient diagnosis - ICD10', '41280-0.176_Date of first in-patient diagnosis - ICD10', '41280-0.177_Date of first in-patient diagnosis - ICD10', '41280-0.178_Date of first in-patient diagnosis - ICD10', '41280-0.179_Date of first in-patient diagnosis - ICD10', '41280-0.180_Date of first in-patient diagnosis - ICD10', '41280-0.181_Date of first in-patient diagnosis - ICD10', '41280-0.182_Date of first in-patient diagnosis - ICD10', '41280-0.183_Date of first in-patient diagnosis - ICD10', '41280-0.184_Date of first in-patient diagnosis - ICD10', '41280-0.185_Date of first in-patient diagnosis - ICD10', '41280-0.186_Date of first in-patient diagnosis - ICD10', '41280-0.187_Date of first in-patient diagnosis - ICD10', '41280-0.188_Date of first in-patient diagnosis - ICD10', '41280-0.189_Date of first in-patient diagnosis - ICD10', '41280-0.190_Date of first in-patient diagnosis - ICD10', '41280-0.191_Date of first in-patient diagnosis - ICD10', '41280-0.192_Date of first in-patient diagnosis - ICD10', '41280-0.193_Date of first in-patient diagnosis - ICD10', '41280-0.194_Date of first in-patient diagnosis - ICD10', '41280-0.195_Date of first in-patient diagnosis - ICD10', '41280-0.196_Date of first in-patient diagnosis - ICD10', '41280-0.197_Date of first in-patient diagnosis - ICD10', '41280-0.198_Date of first in-patient diagnosis - ICD10', '41280-0.199_Date of first in-patient diagnosis - ICD10', '41280-0.200_Date of first in-patient diagnosis - ICD10', '41280-0.201_Date of first in-patient diagnosis - ICD10', '41280-0.202_Date of first in-patient diagnosis - ICD10', '41280-0.203_Date of first in-patient diagnosis - ICD10', '41280-0.204_Date of first in-patient diagnosis - ICD10', '41280-0.205_Date of first in-patient diagnosis - ICD10', '41280-0.206_Date of first in-patient diagnosis - ICD10', '41280-0.207_Date of first in-patient diagnosis - ICD10', '41280-0.208_Date of first in-patient diagnosis - ICD10', '41280-0.209_Date of first in-patient diagnosis - ICD10', '41280-0.210_Date of first in-patient diagnosis - ICD10', '41280-0.211_Date of first in-patient diagnosis - ICD10', '41280-0.212_Date of first in-patient diagnosis - ICD10', '41280-0.213_Date of first in-patient diagnosis - ICD10', '41280-0.214_Date of first in-patient diagnosis - ICD10', '41280-0.215_Date of first in-patient diagnosis - ICD10', '41280-0.216_Date of first in-patient diagnosis - ICD10', '41280-0.217_Date of first in-patient diagnosis - ICD10', '41280-0.218_Date of first in-patient diagnosis - ICD10', '41280-0.219_Date of first in-patient diagnosis - ICD10', '41280-0.220_Date of first in-patient diagnosis - ICD10', '41280-0.221_Date of first in-patient diagnosis - ICD10', '41280-0.222_Date of first in-patient diagnosis - ICD10', '41280-0.223_Date of first in-patient diagnosis - ICD10', '41280-0.224_Date of first in-patient diagnosis - ICD10', '41280-0.225_Date of first in-patient diagnosis - ICD10', '41280-0.226_Date of first in-patient diagnosis - ICD10', '41280-0.227_Date of first in-patient diagnosis - ICD10', '41280-0.228_Date of first in-patient diagnosis - ICD10', '41280-0.229_Date of first in-patient diagnosis - ICD10', '41280-0.230_Date of first in-patient diagnosis - ICD10', '41280-0.231_Date of first in-patient diagnosis - ICD10', '41280-0.232_Date of first in-patient diagnosis - ICD10', '41280-0.233_Date of first in-patient diagnosis - ICD10', '41280-0.234_Date of first in-patient diagnosis - ICD10', '41280-0.235_Date of first in-patient diagnosis - ICD10', '41280-0.236_Date of first in-patient diagnosis - ICD10', '41280-0.237_Date of first in-patient diagnosis - ICD10', '41280-0.238_Date of first in-patient diagnosis - ICD10', '41280-0.239_Date of first in-patient diagnosis - ICD10', '41280-0.240_Date of first in-patient diagnosis - ICD10'
]

df = df.drop(columns = infer_diabetes)
print('Dropped columns which infer diabetes')

diabetics = df['will_develop_diabetes']
when_diabetics = df['when_develops_diabetes']
mean1 = diabetics.mean()
mean2 = when_diabetics.mean()
print(f'Checking means: mean_develops_diabetes = {mean1} = 0.5? mean_develops_diabetes = {mean2} > 0.5?')

date_data = []
date_pattern = re.compile(r'^\d{1,2}/\d{1,2}/(\d{2}|\d{4})$')

for col in df.columns:
    no_nans = df[col].dropna()
    if not no_nans.empty:
        if no_nans.apply(lambda x: bool(date_pattern.match(str(x)))).any():
            date_data.append(col)

print(f"First 5 date columns (proof they exist): {date_data[:5]}")

def convert_to_numeric_dates(df, date_cols):
    for col in date_cols:
        df[col] = pd.to_datetime(df[col], format='%d/%m/%Y', errors='coerce').astype('int64') // (10**9 * 60 * 60 * 24)
    return df

df = convert_to_numeric_dates(df, date_data)

df.replace('', pd.NA, inplace=True)
df.replace(['None', 'N/A', 'null'], pd.NA, inplace=True)

diabetics = df['will_develop_diabetes']
when_diabetics = df['when_develops_diabetes']
mean1 = diabetics.mean()
mean2 = when_diabetics.mean()
print(f'Checking means: mean_develops_diabetes = {mean1} = 0.5? mean_develops_diabetes = {mean2} > 0.5?')

# Ensure all NaN values are consistent
df = df.apply(pd.to_numeric, errors='coerce')

# List to store non-numeric columns
non_numeric_columns = []

# Identify non-numeric columns
for col in df.columns:
    if df[col].dtype == 'object' or not pd.api.types.is_numeric_dtype(df[col]):
        non_numeric_columns.append(col)

#Output the non-numeric columns
print("\nNon-numeric columns identified, here are the first 5:")
print(non_numeric_columns[:5])
print(f'there are {len(non_numeric_columns)} non numerical columns')

diabetics = df['will_develop_diabetes']
when_diabetics = df['when_develops_diabetes']
mean1 = diabetics.mean()
mean2 = when_diabetics.mean()
print(f'Checking means: mean_develops_diabetes = {mean1} = 0.5? mean_develops_diabetes = {mean2} > 0.5?')

df.dropna(thresh= 0.95 * len(df), axis=1, inplace=True)
numeric_cols = df.columns
num_imputer = SimpleImputer(strategy='mean')
df[numeric_cols] = num_imputer.fit_transform(df[numeric_cols])

diabetics = df['will_develop_diabetes']
when_diabetics = df['when_develops_diabetes']
mean1 = diabetics.mean()
mean2 = when_diabetics.mean()
print(f'Checking means: mean_develops_diabetes = {mean1} = 0.5? mean_develops_diabetes = {mean2} > 0.5?')

nan_summary = df.isnull().sum()
nan_columns = nan_summary[nan_summary > 0]

if nan_columns.empty:
    print("No NaN values remaining. Can now test data.")
else:
    print(f"Found NaN values in {len(nan_columns)} columns.")
    print("Columns with NaN values:")
    for col, count in nan_columns.items():
        print(f"{col}: {count} NaN values")

df.to_csv(output_file_path, index=False)
print(f"Cleaned dataset has been written to: {output_file_path}")